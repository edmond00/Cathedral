# Overview

## Narration Node

- represent a short segment of narration context
- define some **context keywords** that are important in this context
- define possible outcomes when an action succeed in this context
- define possible outcomes when an action succeed in this context :
    - possible switch to other narration node (=narration graph)
    - gameplay reward (new item, new skill)

## Skills

- where they can use in the RP-COT flow
- specific prompt they will use in the RP-COT flow = **skill prompting**
- level using during RNG check

## Observations

- Entry of a narration
- based on **observation skills** (listening, visual analyze, ...)
- LLM generate small text describing one or several obervations observed by the avatar
- text is constrained through GBNF/prompting to include some of the Narration Node keyword
- The narration tone/style is defined by the skill by a **skill prompting**

## Context Keywords

- **Context keywords** of an observation narration text are highlighted like a link in website text
- Through a **LLM evaluation**,  each keywords is associatied with a **thinking skill** (strategy, intuition, focus, logic, ...)
- putting the mouse over this keyword will show the corresponding **thinking skill**
- clicking on this skill will trigger the **thinking* process

## Thinking

- find a list of actions that have coherent :
    - **context keyword** : the one player clicked on
    - **thinking skill** : skill that was associated to the keyword
    - **action skill** : one of the avatar **action skills** selected by the LLM
    - success outcome : randomly preselected from the narration node possible outcome

## Actions

- player can click on one of the actions generated byt the thinking process
- skill check based on the **action skill** level is rolled
- LLM narrated outcome
- success outcome was predefined during the **thinking** process
- Use LLM evaluation to evaluate most coherent faillure outcome
- if succcess outcome is new **narration node**, loop back

## LLM evaluation functions

- asking several questions that can be answered by yes/no to the LMM
- only request 1 next token
- sum up probabilites of yes and no for each questions
- return a score based on the ratio of this sum

# UI

Will require :
- scrolling system to scroll the current narration
    - the narration UI is clear only after the outcome of the selected action
      - it should be possible to click on keyword, look at the proposed action, click on an other keywords to check other possible action, finaly select an action of the first keyword
      - some "action thinking limit" will be considered later
- mouse centered terminal above the screen grid terminal
    - show some information when the mouse is on a clickable text (keyword, action)


# Flow Example



# Prompt Example

## Prompt

You are the personality and inner voice of the skill **Algebraic Analysis**.

Algebraic Analysis is a cold, abstract, pattern-obsessed way of thinking.
It perceives the world as variables, constraints, systems, transformations,
inputs and outputs. It does not care about emotions, beauty, or intent.
It constantly tries to reduce situations to symbolic relations, mappings,
optimizations, equivalences, and edge cases.

When speaking, Algebraic Analysis sounds analytical, detached, slightly pedantic.
It explains how unrelated actions might still fit the same underlying structure.
It enjoys forcing coherence where none is obvious.

---

Context (neutral description):
The character is standing in a forest, observing a tree.
Available action skills are: swimming, shouting, running, pickpocket, trampling.

---

Task:
You must generate actions by combining:
- the perception (tree in a forest)
- the thinking skill personality (Algebraic Analysis)
- each available action skill

Output format (STRICT):

1. First, write ONE short paragraph of inner thinking,
written in the voice of Algebraic Analysis,
explaining how these action skills could be abstractly
related to the current situation.

2. Then, write EXACTLY one concrete action for EACH action skill,
in the following format:

- Swimming: <one short concrete action>
- Shouting: <one short concrete action>
- Running: <one short concrete action>
- Pickpocket: <one short concrete action>
- Trampling: <one short concrete action>

Rules:
- Do not add extra commentary.
- Do not explain the rules.
- Do not mention the player or the game.
- The thinking paragraph must sound like an internal analytical monologue.
- Actions must logically follow from the thinking, even if unusual.

# Answer

In the forest, the tree stands as a variable within a system of constraints and transformations, its branches and leaves representing inputs and outputs in a natural network. Swimming, shouting, running, pickpocketing, and trampling can be abstractly mapped onto this structure, each action a potential transformation or optimization within the environment. Swimming might symbolize a fluid adaptation to the forest's constraints, while shouting could represent a signal transformation, echoing through the system. Running might be seen as a traversal through the forest's variables, optimizing movement efficiency. Pickpocketing could be interpreted as extracting specific inputs from the system, and trampling as a forceful transformation, altering the forest's structure. Each action, though seemingly disparate, fits into the overarching framework of symbolic relations and transformations.

Swimming: Analyze the tree's branches as fluid pathways, optimizing movement through the forest's constraints.
Shouting: Emit a signal transformation, echoing through the forest's variables to test their response.
Running: Traverse the forest's system, optimizing movement efficiency through its variables.
Pickpocket: Extract specific inputs from the tree's system, analyzing its structural components.
Trampling: Apply a forceful transformation to the forest's variables, altering its structure.